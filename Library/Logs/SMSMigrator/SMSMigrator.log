2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: deleted_messages
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: chat_handle_join
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: sync_deleted_messages
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: message_processing_task
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: handle
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: sync_deleted_chats
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: message_attachment_join
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: sync_deleted_attachments
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: kvtable
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created table (if needed) ok: chat_message_join
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_handle_join_idx_handle_id
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_attachment_join_idx_attachment_id
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_date
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_handle
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_handle_id
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_message_join_idx_message_id_only
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_associated_message
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_idx_chat_identifier
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_processing_task_idx_guid_task_flags
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_message_join_idx_chat_id
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_idx_chat_room_name_service_name
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_other_handle
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_message_join_idx_message_id_date_chat_id
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_was_downgraded
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_idx_is_archived
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_expire_state
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: chat_idx_chat_identifier_service_name
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_is_read
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_idx_failed
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created index ok: message_attachment_join_idx_message_id
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_delete_on_chat_message_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat_message_join AFTER DELETE ON chat_message_join BEGIN     UPDATE message       SET cache_roomnames = (         SELECT group_concat(c.room_name)         FROM chat c         INNER JOIN chat_message_join j ON c.ROWID = j.chat_id         WHERE           j.message_id = OLD.message_id       )       WHERE         message.ROWID = OLD.message_id;  DELETE FROM message WHERE message.ROWID = OLD.message_id AND OLD.message_id NOT IN (SELECT chat_message_join.message_id from chat_message_join WHERE chat_message_join.message_id = OLD.message_id LIMIT 1); END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_delete_on_attachment, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_attachment AFTER DELETE ON attachment BEGIN   SELECT delete_attachment_path(OLD.filename); END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_insert_on_message_attachment_join, trigger: CREATE TRIGGER IF NOT EXISTS after_insert_on_message_attachment_join AFTER INSERT ON message_attachment_join BEGIN     UPDATE message       SET cache_has_attachments = 1     WHERE       message.ROWID = NEW.message_id; END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: update_message_date_after_update_on_message, trigger: CREATE TRIGGER IF NOT EXISTS update_message_date_after_update_on_message AFTER UPDATE OF date ON message BEGIN UPDATE chat_message_join SET message_date = NEW.date WHERE message_id = NEW.ROWID AND message_date != NEW.date; END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_delete_on_chat_handle_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat_handle_join AFTER DELETE ON chat_handle_join BEGIN     DELETE FROM handle         WHERE handle.ROWID = OLD.handle_id     AND         (SELECT 1 from chat_handle_join WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE other_handle = OLD.handle_id LIMIT 1) IS NULL; END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_delete_on_message, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_message AFTER DELETE ON message BEGIN     DELETE FROM handle         WHERE handle.ROWID = OLD.handle_id     AND         (SELECT 1 from chat_handle_join WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE other_handle = OLD.handle_id LIMIT 1) IS NULL; END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_insert_on_chat_message_join , trigger: CREATE TRIGGER IF NOT EXISTS after_insert_on_chat_message_join  AFTER INSERT ON chat_message_join BEGIN     UPDATE message       SET cache_roomnames = (         SELECT group_concat(c.room_name)         FROM chat c         INNER JOIN chat_message_join j ON c.ROWID = j.chat_id         WHERE           j.message_id = NEW.message_id       )       WHERE         message.ROWID = NEW.message_id; END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_delete_on_chat, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat AFTER DELETE ON chat BEGIN DELETE FROM chat_message_join WHERE chat_id = OLD.ROWID; END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: delete_associated_messages_after_delete_on_message, trigger: CREATE TRIGGER IF NOT EXISTS delete_associated_messages_after_delete_on_message AFTER DELETE ON message BEGIN DELETE FROM message WHERE (OLD.associated_message_guid IS NULL AND associated_message_guid IS NOT NULL AND guid = OLD.associated_message_guid); END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: before_delete_on_attachment, trigger: CREATE TRIGGER IF NOT EXISTS before_delete_on_attachment BEFORE DELETE ON attachment BEGIN   SELECT before_delete_attachment_path(OLD.ROWID, OLD.guid); END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: add_to_deleted_messages, trigger: CREATE TRIGGER IF NOT EXISTS add_to_deleted_messages AFTER DELETE ON message BEGIN     INSERT INTO deleted_messages (guid) VALUES (OLD.guid); END
2018-05-06 15:30:33 -0700 IMDPersistenceAgent[628]: Created trigger ok: after_delete_on_message_attachment_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_message_attachment_join AFTER DELETE ON message_attachment_join BEGIN     DELETE FROM attachment         WHERE attachment.ROWID = OLD.attachment_id     AND         (SELECT 1 from message_attachment_join WHERE attachment_id = OLD.attachment_id LIMIT 1) IS NULL; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: The current SMS database is v11018.  The current schema version is v11027. Can be migrated: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Beginning migration.  The SMS db is currently at v11018, upgrading to v11027.
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Integrity checked success
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Initial Integrity checked success
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_delete_on_chat_message_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_delete_on_attachment
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_insert_on_message_attachment_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: update_message_date_after_update_on_message
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_delete_on_chat_handle_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_delete_on_message
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_insert_on_chat_message_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_delete_on_chat
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: delete_associated_messages_after_delete_on_message
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: before_delete_on_attachment
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: add_to_deleted_messages
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped trigger: after_delete_on_message_attachment_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11018 to 11019 ok in 0.002365 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_server_change_token to chat succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_sync_state to chat succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11019 to 11020 ok in 0.001071 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_sync_state to message succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_record_id to message succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_record_change_tag to message succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11020 to 11021 ok in 0.001899 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_record_id to attachment succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_sync_state to attachment succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_ck_server_change_token_blob to attachment succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11021 to 11022 ok in 0.001115 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11022 to 11023 ok in 0.000230 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column cloudkit_record_id to chat succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Adding column sr_cloudkit_record_id to chat succeeded: YES
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11023 to 11024 ok in 0.001144 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11024 to 11025 ok in 0.000226 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11025 to 11026 ok in 0.000190 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Dropped table (if needed) ok: sqlite_stat1
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Migrated from 11026 to 11027 ok in 0.000192 seconds
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: deleted_messages
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: chat_handle_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: sync_deleted_messages
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: message_processing_task
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: handle
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: sync_deleted_chats
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: message_attachment_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: sync_deleted_attachments
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: kvtable
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created table (if needed) ok: chat_message_join
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_attachment_join_idx_message_id
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_handle_join_idx_handle_id
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_attachment_join_idx_attachment_id
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_date
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_handle
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_handle_id
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_message_join_idx_message_id_only
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_associated_message
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_idx_chat_identifier
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_processing_task_idx_guid_task_flags
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_message_join_idx_chat_id
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_cache_has_attachments
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_idx_chat_room_name_service_name
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_other_handle
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_message_join_idx_message_id_date_chat_id
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_was_downgraded
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_idx_is_archived
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: chat_idx_chat_identifier_service_name
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_expire_state
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_is_read
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_failed
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created index ok: message_idx_isRead_isFromMe_itemType
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_delete_on_chat_message_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat_message_join AFTER DELETE ON chat_message_join BEGIN     UPDATE message       SET cache_roomnames = (         SELECT group_concat(c.room_name)         FROM chat c         INNER JOIN chat_message_join j ON c.ROWID = j.chat_id         WHERE           j.message_id = OLD.message_id       )       WHERE         message.ROWID = OLD.message_id;  DELETE FROM message WHERE message.ROWID = OLD.message_id AND OLD.message_id NOT IN (SELECT chat_message_join.message_id from chat_message_join WHERE chat_message_join.message_id = OLD.message_id LIMIT 1); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_delete_on_attachment, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_attachment AFTER DELETE ON attachment BEGIN   SELECT delete_attachment_path(OLD.filename); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_insert_on_message_attachment_join, trigger: CREATE TRIGGER IF NOT EXISTS after_insert_on_message_attachment_join AFTER INSERT ON message_attachment_join BEGIN     UPDATE message       SET cache_has_attachments = 1     WHERE       message.ROWID = NEW.message_id; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_delete_on_chat_handle_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat_handle_join AFTER DELETE ON chat_handle_join BEGIN     DELETE FROM handle         WHERE handle.ROWID = OLD.handle_id     AND         (SELECT 1 from chat_handle_join WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE other_handle = OLD.handle_id LIMIT 1) IS NULL; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_insert_on_chat_message_join , trigger: CREATE TRIGGER IF NOT EXISTS after_insert_on_chat_message_join  AFTER INSERT ON chat_message_join BEGIN     UPDATE message       SET cache_roomnames = (         SELECT group_concat(c.room_name)         FROM chat c         INNER JOIN chat_message_join j ON c.ROWID = j.chat_id         WHERE           j.message_id = NEW.message_id       )       WHERE         message.ROWID = NEW.message_id; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_delete_on_message, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_message AFTER DELETE ON message BEGIN     DELETE FROM handle         WHERE handle.ROWID = OLD.handle_id     AND         (SELECT 1 from chat_handle_join WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE other_handle = OLD.handle_id LIMIT 1) IS NULL; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: update_message_date_after_update_on_message, trigger: CREATE TRIGGER IF NOT EXISTS update_message_date_after_update_on_message AFTER UPDATE OF date ON message BEGIN UPDATE chat_message_join SET message_date = NEW.date WHERE message_id = NEW.ROWID AND message_date != NEW.date; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: add_to_sync_deleted_messages, trigger: CREATE TRIGGER IF NOT EXISTS add_to_sync_deleted_messages AFTER DELETE ON message BEGIN     INSERT INTO sync_deleted_messages (guid, recordID) VALUES (OLD.guid, OLD.ck_record_id); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_delete_on_chat, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat AFTER DELETE ON chat BEGIN DELETE FROM chat_message_join WHERE chat_id = OLD.ROWID; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: delete_associated_messages_after_delete_on_message, trigger: CREATE TRIGGER IF NOT EXISTS delete_associated_messages_after_delete_on_message AFTER DELETE ON message BEGIN DELETE FROM message WHERE (OLD.associated_message_guid IS NULL AND associated_message_guid IS NOT NULL AND guid = OLD.associated_message_guid); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: before_delete_on_attachment, trigger: CREATE TRIGGER IF NOT EXISTS before_delete_on_attachment BEFORE DELETE ON attachment BEGIN   SELECT before_delete_attachment_path(OLD.ROWID, OLD.guid); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: add_to_sync_deleted_attachments, trigger: CREATE TRIGGER IF NOT EXISTS add_to_sync_deleted_attachments AFTER DELETE ON attachment BEGIN     INSERT INTO sync_deleted_attachments (guid, recordID) VALUES (OLD.guid, OLD.ck_record_id); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: add_to_deleted_messages, trigger: CREATE TRIGGER IF NOT EXISTS add_to_deleted_messages AFTER DELETE ON message BEGIN     INSERT INTO deleted_messages (guid) VALUES (OLD.guid); END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Created trigger ok: after_delete_on_message_attachment_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_message_attachment_join AFTER DELETE ON message_attachment_join BEGIN     DELETE FROM attachment         WHERE attachment.ROWID = OLD.attachment_id     AND         (SELECT 1 from message_attachment_join WHERE attachment_id = OLD.attachment_id LIMIT 1) IS NULL; END
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Integrity checked success
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Message database migration passed post migrate integrity check
2018-07-02 18:50:29 -0700 IMDPersistenceAgent[365]: Message's DB migration took 0.029421 seconds.
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: The current SMS database is v11027.  The current schema version is v12005. Can be migrated: YES
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Beginning migration.  The SMS db is currently at v11027, upgrading to v12005.
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Integrity checked success
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Initial Integrity checked success
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_delete_on_chat_message_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_delete_on_attachment
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_insert_on_message_attachment_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_delete_on_chat_handle_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_insert_on_chat_message_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_delete_on_message
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: update_message_date_after_update_on_message
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: add_to_sync_deleted_messages
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_delete_on_chat
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: delete_associated_messages_after_delete_on_message
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: before_delete_on_attachment
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: add_to_sync_deleted_attachments
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: add_to_deleted_messages
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped trigger: after_delete_on_message_attachment_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped unknown index: chat_message_join_idx_message_id_date_chat_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped table (if needed) ok: sqlite_stat1
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Adding column person_centric_id to handle succeeded: YES
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Migrated from 11027 to 12000 ok in 0.003426 seconds
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped table (if needed) ok: sqlite_stat1
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Found column person_centric_id on handle, no need to add it
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Migrated from 12000 to 12001 ok in 0.000306 seconds
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped table (if needed) ok: sqlite_stat1
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Migrated from 12001 to 12002 ok in 0.000179 seconds
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped table (if needed) ok: sqlite_stat1
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Migrated from 12002 to 12003 ok in 0.000159 seconds
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped table (if needed) ok: sqlite_stat1
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Adding column is_corrupt to message succeeded: YES
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Migrated from 12003 to 12004 ok in 0.000806 seconds
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Dropped table (if needed) ok: sqlite_stat1
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Adding column last_addressed_sim_id to chat succeeded: YES
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Migrated from 12004 to 12005 ok in 0.000535 seconds
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: deleted_messages
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: chat_handle_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: sync_deleted_messages
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: message_processing_task
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: handle
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: sync_deleted_chats
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: message_attachment_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: sync_deleted_attachments
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: kvtable
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created table (if needed) ok: chat_message_join
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_expire_state
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_attachment_join_idx_message_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_handle_join_idx_handle_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_attachment_join_idx_attachment_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_date
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_handle
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_handle_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_is_sent_is_from_me_error
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_message_join_idx_message_id_only
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_associated_message
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_idx_chat_identifier
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_processing_task_idx_guid_task_flags
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_message_join_idx_chat_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_cache_has_attachments
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_idx_chat_room_name_service_name
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_other_handle
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_was_downgraded
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_idx_is_archived
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_idx_chat_identifier_service_name
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: chat_message_join_idx_message_date_id_chat_id
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_is_read
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_isRead_isFromMe_itemType
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created index ok: message_idx_failed
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_delete_on_chat_message_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat_message_join AFTER DELETE ON chat_message_join BEGIN     UPDATE message       SET cache_roomnames = (         SELECT group_concat(c.room_name)         FROM chat c         INNER JOIN chat_message_join j ON c.ROWID = j.chat_id         WHERE           j.message_id = OLD.message_id       )       WHERE         message.ROWID = OLD.message_id;  DELETE FROM message WHERE message.ROWID = OLD.message_id AND OLD.message_id NOT IN (SELECT chat_message_join.message_id from chat_message_join WHERE chat_message_join.message_id = OLD.message_id LIMIT 1); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_delete_on_attachment, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_attachment AFTER DELETE ON attachment BEGIN   SELECT delete_attachment_path(OLD.filename); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_insert_on_message_attachment_join, trigger: CREATE TRIGGER IF NOT EXISTS after_insert_on_message_attachment_join AFTER INSERT ON message_attachment_join BEGIN     UPDATE message       SET cache_has_attachments = 1     WHERE       message.ROWID = NEW.message_id; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_delete_on_chat_handle_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat_handle_join AFTER DELETE ON chat_handle_join BEGIN     DELETE FROM handle         WHERE handle.ROWID = OLD.handle_id     AND         (SELECT 1 from chat_handle_join WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE other_handle = OLD.handle_id LIMIT 1) IS NULL; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_insert_on_chat_message_join , trigger: CREATE TRIGGER IF NOT EXISTS after_insert_on_chat_message_join  AFTER INSERT ON chat_message_join BEGIN     UPDATE message       SET cache_roomnames = (         SELECT group_concat(c.room_name)         FROM chat c         INNER JOIN chat_message_join j ON c.ROWID = j.chat_id         WHERE           j.message_id = NEW.message_id       )       WHERE         message.ROWID = NEW.message_id; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_delete_on_message, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_message AFTER DELETE ON message BEGIN     DELETE FROM handle         WHERE handle.ROWID = OLD.handle_id     AND         (SELECT 1 from chat_handle_join WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE handle_id = OLD.handle_id LIMIT 1) IS NULL     AND         (SELECT 1 from message WHERE other_handle = OLD.handle_id LIMIT 1) IS NULL; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: update_message_date_after_update_on_message, trigger: CREATE TRIGGER IF NOT EXISTS update_message_date_after_update_on_message AFTER UPDATE OF date ON message BEGIN UPDATE chat_message_join SET message_date = NEW.date WHERE message_id = NEW.ROWID AND message_date != NEW.date; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: add_to_sync_deleted_messages, trigger: CREATE TRIGGER IF NOT EXISTS add_to_sync_deleted_messages AFTER DELETE ON message BEGIN     INSERT INTO sync_deleted_messages (guid, recordID) VALUES (OLD.guid, OLD.ck_record_id); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_delete_on_chat, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_chat AFTER DELETE ON chat BEGIN DELETE FROM chat_message_join WHERE chat_id = OLD.ROWID; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: delete_associated_messages_after_delete_on_message, trigger: CREATE TRIGGER IF NOT EXISTS delete_associated_messages_after_delete_on_message AFTER DELETE ON message BEGIN DELETE FROM message WHERE (OLD.associated_message_guid IS NULL AND associated_message_guid IS NOT NULL AND guid = OLD.associated_message_guid); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: before_delete_on_attachment, trigger: CREATE TRIGGER IF NOT EXISTS before_delete_on_attachment BEFORE DELETE ON attachment BEGIN   SELECT before_delete_attachment_path(OLD.ROWID, OLD.guid); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: add_to_sync_deleted_attachments, trigger: CREATE TRIGGER IF NOT EXISTS add_to_sync_deleted_attachments AFTER DELETE ON attachment BEGIN     INSERT INTO sync_deleted_attachments (guid, recordID) VALUES (OLD.guid, OLD.ck_record_id); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: add_to_deleted_messages, trigger: CREATE TRIGGER IF NOT EXISTS add_to_deleted_messages AFTER DELETE ON message BEGIN     INSERT INTO deleted_messages (guid) VALUES (OLD.guid); END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Created trigger ok: after_delete_on_message_attachment_join, trigger: CREATE TRIGGER IF NOT EXISTS after_delete_on_message_attachment_join AFTER DELETE ON message_attachment_join BEGIN     DELETE FROM attachment         WHERE attachment.ROWID = OLD.attachment_id     AND         (SELECT 1 from message_attachment_join WHERE attachment_id = OLD.attachment_id LIMIT 1) IS NULL; END
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Integrity checked success
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Message database migration passed post migrate integrity check
2018-10-24 20:08:59 -0700 IMDPersistenceAgent[678]: Message's DB migration took 0.413291 seconds.
